<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <link rel="icon" href="favicon.svg">
    <link rel=”mask-icon” href=”favicon.svg” color=”#000000">
    <link rel="apple-touch-icon" href="favicon.png">
    <meta name="theme-color" content="#000000">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400;1,700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />

    <title>Matthew Matz - Piper Make</title>

    <link rel="stylesheet" href="assets/index.css">
    <script src="assets/index.js"></script>

    <style>
        code *,
        pre * {
            font-family: 'Source Code Pro', monospace;
        }
        code {
            font-size: 80%;
        }
        .hljs-comment, .hljs-quote {
            font-family: 'Raleway', sans-serif;
            color: rgb(76, 134, 134) !important; 
        }
    </style>

    <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/styles/atom-one-dark-reasonable.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"
        integrity="sha512-bgHRAiTjGrzHzLyKOnpFvaEpGzJet3z4tZnXGjpsCcqOnAH6VGUx9frc5bcIhKTVLEiCO6vEhNAgx5jtLUYrfA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>

<body>
    <nav>
        <ul>
            <li aria-roledescription="link" tabindex="0" onclick="linkTo('index.html#work', false)">
                <button class="material-symbols-outlined selected">arrow_back</button>
                <span class="tooltiptext">Back</span>
            </li>
        </ul>
    </nav>

    <div class="nav-marker"></div>

    <section>
        <div class="center-box">
            <div class="container">
                <div class="column text">
                    <h2>Piper Make</h2>
                    <img src="images/portfolio/piper-make/make-products.png"/>
                    <p><a href="https://make.playpiper.com" target="_blank">Piper Make</a> is the largest and longest project I&apos;ve ever been involved with. I&apos;m proud of the work I&apos;ve done on it and I&apos;m proud of my coworkers and collaborating contractors work too.  It&apos;s an amazing product that is already making a difference in classrooms around the world.</p>
                    <img src="images/portfolio/piper-make/make-site.png"/>
                    <h3>The History of Piper Make</h3>
                    <p>Piper Learning is famous for the wooden Raspberry Pi computer that you build yourself.  On its own, that&apos;s an amazing product too.  I first met the Piper team at ISTE in Denver Colorado when I was working at Parallax Inc.  Our booth was right across the aisle from theirs.</p>
                    <p>We had a great time and some great conversations, and at the time, I figured that at most, I might bump into them again at another trade show.</p>
                    <p>Fast forward a few years later - I had since left Parallax and reconnected with Piper Learning.  At first, I worked with them to create a few educational resources.  I then helped with a few things on their e-commerce site, and eventually began working on something called the &quot;Command Center&quot;, which was an Arduino-powered game controller.</p>
                    <img src="images/portfolio/piper-make/command-center.webp"/>
                    <p>The genesis of the Command Center happened before I started working for them.  But even then, it was always sold as a &quot;BETA&quot;, and whatever came next was going to be based on it.</p>
                    <h4>PiperLab</h4>
                    <p>Along with a few other Piper engineers, we focused on the development of a new platform and product called PiperLab. Despite being almost production-ready, this early iteration of what would later become Piper Make was never released.</p>
                    <p>We replaced the Arduino with an <a href="https://www.adafruit.com/product/3800" target="_blank" >Adafruit ItsyBitsy M4</a>, and built up an entire platform around Blockly and CircuitPython, and I developed a novel method for programming the microcontroller module directly from the browser.  I also developed a means for routing the incoming serial stream to do more than just show things in the terminal - but more on the details later.</p>
                    <h4>Out of Nowhere...The Pi Pico!</h4>
                    <p>Piper's products had long been built on the Raspberry Pi platform, starting with their flagship Piper Computer Kit. While other microcontrollers like Adafruit's ItsyBitsy were awesome, Piper's close partnership with Raspberry Pi was always a powerful part of their brand and something we were happy to continue in this new project.</p>
                    <p>When Raspberry Pi introduced the RP2040 and the Pico in January 2021, it took the maker community by storm, and when I told Chris Bouman, Piper&apos;s COO, that I thought we could re-tool PiperLab to work with the Pico, he was excited about that possibility.</p>
                    <img src="images/portfolio/piper-make/pi-pico.webp"/>
                    <p>By the end of February, the project had fully pivoted to using the Pico and getting away from the game controller concept in favor of a simpler breadboarded &ldquo;makers kit&rdquo;. It was also branded under a new name: Piper Make.</p>
                    <p>Because we were so close, the goal was to launch it on Pi Day (March 14th) 2021, and we managed to pull that off, too!</p>
                    <iframe width="560" height="315" src="https://www.youtube.com/embed/jcFxUiRCeV0" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
                    <h3>Some Good Press</h3>
                    <p>Out of the gate, the product got some good press, which was personally validating!</p>
                    <ul>
                        <li><a href="https://www.hackster.io/news/piper-launches-piper-make-visual-coding-environment-for-the-raspberry-pi-pico-hardware-subs-dd4370bfee9f" target="_blank">Hackster.io: Piper Launches Piper Make Visual Coding Environment for the Raspberry Pi Pico</a></li>
                        <li><a href="https://www.tomshardware.com/news/raspberry-pi-pico-piper-make?utm_campaign=socialflow&utm_medium=social&utm_source=twitter.com" target="_blank">Tom&apos;s Hardware: Piper Make Is a Raspberry Pi Pico Drag and Drop Python Editor</a></li>
                        <li><a href="https://makezine.com/article/technology/raspberry-pi/play-the-piper-for-pi-day/" target="_blank">Make Magazine: Play the Piper for Pi Day</a></li>
                    </ul>
                    <h3>The Monthly Maker&apos;s Club</h3>
                    <p>The <a href="https://www.playpiper.com/products/piper-make-starter-expedition-kit" target="_blank">Piper Make Starter Kit</a>, which includes:</p>
                    <ul>
                        <li>Large Breadboard with Laser Cut, Laser Etched Wood Base
                        <li>Jumper Wires (10 - M2M)</li>
                        <li>Resistors (10)</li>
                        <li>Tactile Buttons (3)</li>
                        <li>LEDs (5)</li>
                        <li>Micro-USB to USB-A cable</li>
                        <li>Piper Make Stickers</li>
                    </ul>
                    <p>is the flagship product, and the Monthly Maker&apos;s Club was a subscription-based service where we would send a new product with at least 1 (and usually 2 or 3) projects to accompany that product.  It was, to be honest, a brutal schedule to keep, and I was happy when we made it through that 12 month commitment.  I was designing each kit and writing the accompanying tutorials, all while teaching full time.  On Piper&apos;s end, it was a small team doing the production, sales, and marketing - and looking back on it we pulled off a miracle every month.</p>
                    <p>The upside of the Monthly Maker&apos;s Club is that it forced us to grow the product line quickly.  Some of the monthly kits became permanent products, and others were revised into even better standalone products.</p>
                    <h3>Current Product Line</h3>
                    <p>The Piper Make Product Line has grown to include:</p>
                    <ul>
                        <li>Starter Kit</li>
                        <li>Game Controller</li>
                        <li>Sensor Explorer (this is a kit for the Piper Computer that is also compatible with Piper Make)</li>
                        <li>Light Show</li>
                        <li>Beam Break</li>
                        <li>Motion Ball</li>
                        <li>Solar House</li>
                        <li>Soil Sensor</li>
                        <li>Robotic Rover</li>
                        <li>Robotic Walker</li>
                        <li>Heart Rate Sensor</li>
                    </ul>
                    <img src="images/portfolio/piper-make/make-kits.png"/>
                    <p>Since March of 2021, I have designed each one of the kits.  I work with the Piper team to come up with ideas, then I design a prototype in CAD that they can cut out using their on-site laser cutters.  From there, we do a few design reviews to work out the kinks, branding, and production.</p>
                    <img src="images/portfolio/piper-make/cad-designs.png"/>
                    <iframe width="560" height="315" src="https://www.youtube.com/embed/y7fZyHvdACc" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
                    <p>Once a kit is good to go for production, I or one of the Piper team members writes a tutorial or two for it.</p>
                    <p>As for graphics, Shree designs the &quot;blueprints&quot;, which are kid-friendly assembly instructions along with the homepage graphics to incorporate it into the story arc that makes Piper Make so engaging.</p>
                    <img src="images/portfolio/piper-make/beam-break-blueprint.png"/>
                    <p>I create all of the diagrams and educational graphics within the tutorial using Inkscape.  We publish them as SVGs so that they scale cleanly and students can zoom into any of them if necessary.</p>
                    <img src="images/portfolio/piper-make/stoplight_2_circuit.svg"/>
                    <h3>The Software Magic</h3>
                    <p>The timing of Piper Make&apos;s release happened to correspond with the release of a Chrome browser feature that makes it possible: <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Serial_API" target="_blank"><b>Web-serial</b></a>.  I wish that every modern browser would implement it, but so far Chromium-based browsers are the only ones that do.</p>
                    <p>Deciding to leverage Web-serial and essentially <em>require</em> that user&apos;s use Chrome (or Edge or Opera) was a calculated choice.  When your development team is 1 part-time person and the occasional few hours from another contractor here or there, you do what you can.  Developing an application/extension/client-agent was just not possible given our available resources.</p>
                    <h4>Web-serial + CircuitPython + Paste-mode = 💕</h4>
                    <p>Web-serial is a really cool technology.  It&apos;s an extension of Web-USB, and it allows any serial device (think Arduino, Micro:bit, Pi Pico, ESP32, etc.) to communicate directly with the Javascript on a web page.  It relies on promises and streams, but it&apos;s fairly easy to implement. <a href="https://codelabs.developers.google.com/codelabs/web-serial#0" target="_blank">Google created a really good primer on it here.</a></p>
                    <p>The second technology that makes this all work is Adafruit&apos;s <a href="https://circuitpython.org/" target="_blank">CircuitPython</a> - more specifically, the <a href="https://codewith.mu/en/tutorials/1.2/repl" target="_blank">REPL (Read-Evaluate-Print-Loop)</a>. Essentially, you can terminal into the serial device, type Python code right into the terminal, and when you press enter, it runs the code you just typed!</p>
                    <p>We knew we wanted this to be kid-friendly, and <a href="https://developers.google.com/blockly" target="_blank">Google&apos;s Blockly</a> is a great, open-source tool to help kids learn programming.  And you can get Blockly to generate nearly any kind of code you want - including Python.</p>
                    <p>The trick, then, was to get the Blockly generated code &quot;typed&quot; into the serial terminal (or more accurately, the serial stream). After banging my head on the table for a few days and obsessing over line breaks, carriage returns, and tabs - I decided to RTFM (read the effin&apos; manual).</p>
                    <p>That&apos;s when I stumbled across <b>Paste Mode</b>.  You can find it in MicroPython&apos;s documentation <a href="https://docs.micropython.org/en/latest/reference/repl.html" target="_blank">here</a>.  CiruitPython is a fork of MicroPython, so they share many of the same core behaviors, paste-mode being one of them.  And that&apos;s what we needed to get this all to work!</p>
                    <h4>What it looks like in JavaScript</h4>
                    <p>This isn&apos;t all of it, but there are three important parts to the serial connection in the browser. This first part is what I could best describe as the handshake where the connection is established.  The things worth noting are the delays, which help make sure things don&apos;t talk over each other, and the use of ASCII 3, 4, and 5 (Control-C, Control-D, and Control-E).  These toggle the REPL and Paste Mode when done in the right order and at the appropriate time.</p>
                    <pre><code class="language-javascript">
async function loadDevice(loadCode, payload) {

    // Make sure the Serial API writer exists
    if (serialConnection.writer) {

        // send CTRL-C to enter the REPL
        serialConnection.writer.write(String.fromCharCode(3));
        serialConnection.currentState = 'REPL';

        // give the uC time to respond
        await delay(50);

        // send CTRL-D to leave REPL (should be ignored if we aren't in the REPL)
        try {
            serialConnection.writer.write(String.fromCharCode(4));
            serialConnection.currentState = 'UART';
        } catch (error) {
            showErrorModal(error);
        }

        // give the uC time to respond
        await delay(50);

        // if this function is being called to stop running code, that should have happened, so the function can simply exit
        if (!loadCode) {
            return;
        }

        // Attempt to open the REPL (Try for 2 seconds total)
        for (let i = 0; i < 8; i++) {

            // send CTRL-C to enter the REPL
            serialConnection.writer.write(String.fromCharCode(3));

            // listen for the REPL prompt
            for (let j = 0; j < 5; j++) {

                // give the uC time to respond
                await delay(50);

                // Verify that a REPL was opened
                if (serialConnection.buffer.indexOf('\n>>>') > -1) {
                    serialConnection.buffer = '';
                    serialConnection.currentState = 'REPL';
                    break;
                }
            }

            // If the prompt if found, break out of this loop and continue on
            if (serialConnection.currentState === 'REPL') {
                break;
            }
        }

        // If the REPL prompt was found, continue trying to load code
        if (serialConnection.currentState === 'REPL') {
            serialConnection.writer.write(String.fromCharCode(5));
            await delay(150);

            // Attempt to get into paste mode (Retry up to 15 times: 1.5 seconds)
            let connectionEstablished = false;
            for (let i = 0; i < 15; i++) {
                if (serialConnection.buffer.indexOf('===') > -1) {
                    connectionEstablished = true;
                    serialConnection.buffer = '';
                    serialConnection.currentState = 'PASTE';
                    break;
                }
                serialConnection.writer.write(String.fromCharCode(5));
                await delay(100);
            }

            // If a valid editor (where the user's python code is) and the device is in the 
            // correct state, load the user's python code to the device
            if (connectionEstablished && editor) {

                let code = '';
                if (payload) {
                    code = payload;
                } else {
                    code = getPythonCode(true);
                    // Some code modules don't play nice when you try to stop them and then run something else
                    // this trick causes a HARD reset of the microcontroller.  
                    // It does cause a disconnect, but that's preferable to a lock-up.
                    if (code.indexOf('adafruit_hid') > -1 || code.indexOf('piper_controller') > -1) {
                        serialConnection.flagHID = true;
                    }
                }

                // Write code to the uC, then signal that the paste is complete
                serialConnection.writer.write(code + String.fromCharCode(4));

                // wait based on length of code to send
                await delay(Math.floor(code.length * 10000 / serialConnection.baudRate) + 10); 

                // Clear the buffer used to monitor the connection and set the state
                serialConnection.buffer = '';
                serialConnection.currentState = 'RUNNING';

                if (!payload) {
                    // Set the UI to indicate that a program is running
                    setStartStopButtons(false);

                    // set a watchdog to see if the Python code has stopped or errored
                    serialConnection.codeRunningMonitor = setInterval(replFlagWatchdog, 1000);

                    // Clear the console and graph
                    if (!serialConnection.showVerbose) {
                        term.display(null);
                    }
                    clearGraphData();

                } else {
                    return;
                }

            // If for some really strange reason the python editor object doesn't exist, 
            // let the user know something is wrong - this state has never been reached that I'm aware of
            } else if (!editor) {
                console.error('WebSerial Error: Code editor unavailable');
                showErrorModal('unknown');
                disconnect();

            // The code above was unable to get the device into &quot;Paste Mode&quot;, so code couldn't be loaded.
            } else {
                // serialConnection.currentState = 'REPL';
                console.error('WebSerial Error: Unable to enter Paste Mode');
                showErrorModal('try-again');
                disconnect();
            }

        // The device wasn't presenting a prompt for the REPL, of the code above couldn't parse it out of the incoming stream
        } else {
            console.error('WebSerial Error: Unable to open the REPL');
            showErrorModal('multiple-devices');
            disconnect();
        }
    }
}
                    </code></pre>
                    <p>Sending a stream to the browser is something I worked with on <a href="https://solo.parallax.com">Parallax&apos;s BlocklyProp</a>, and I learned on that project that it&apos;s too easy for users to crush the browser with a massive stream of characters, which all but locks up the browser.</p>
                    <p>On the BlocklyProp project, I implemented a watchdog that monitors the stream&apos;s character rate, and if it&apos;s too high, it shuts down the connection and warns the user. Since it worked so well on that system, I implemented it in Piper Make as well:</p>
                    <pre><code class="language-javascript">
async function readLoop() {

    // Used to track how frequently characters are received to prevent lock-ups and slow-downs
    let receiveTimestamp = performance.now();
    let receiveCounter = 0;

    while (true) {

        const { value, done } = await serialConnection.reader.read();

        if (value) {
            // buffer characters to watch for errors and count incoming characters
            serialConnection.buffer += value.replace(/[^>=\n\rEro:]*/g, '');
            receiveCounter += value.length;

            if (serialConnection.charRateCheck) {
                // calculate the number of characters received each millisecond.
                let timeNow = performance.now();
                let timeDifference = timeNow - receiveTimestamp;

                // check every second to see if too many characters are coming in
                if (timeDifference > 1000) {
                    let receiveFrequency = receiveCounter/timeDifference;

                    receiveTimestamp = timeNow;
                    receiveCounter = 0;
                    
                    // If too many characters are coming in (rate is too high), 
                    // close the connection before something really goes wrong and alert the user.
                    if (receiveFrequency > 5) {
                        serialConnection.overflowConnectionCloser('characters');
                    }
                }
            }

            // only display to the console when running
            if (serialConnection.currentState === 'RUNNING' || serialConnection.showVerbose) {
                term.display(value);
            }
        }

        if (done) {
            serialConnection.reader.releaseLock();
            setConnectionButtonsState(false);
            serialConnection.currentState = 'NONE';
            break;
        }
    }
}
                    </code></pre>
                    <p>The next thing I implemented was a sort of &quot;routing markup&quot; within the serial stream sent from the Pi Pico to the browser. This let us add commands where the Pico could trigger behaviors on the browser. This was how we implemented many of the features that already existed on the Piper Computer Kit.</p>
                    <p>We created commands such as:</p>
                    <ul>
                        <li>System: allows for reading firmware version, installed CircuitPython libraries to see if updates are necessary</li>
                        <li>Shout: displays large text promptly in the center of the screen</li>
                        <li>Sound: play sound clips or synthesized notes (using Tone.js)</li>
                        <li>Graph: display data in a graph</li>
                        <li>Digital View: shows the pin or LED state (digital or analog) in real-time:</li>
                    </ul>
                    <img src="images/portfolio/piper-make/digital-view.png"/>
                    <p>When a &quot;marked&quot; packet comes through the serial stream, instead of being sent to the terminal, the information is routed somewhere else depending on the command.  This allowed me to add a ton of features and interactivity to the platform.</p>
                    <h3>Story Mode - Where We are Going from Here</h3>
                    <p><a href="https://www.shreebose.com/">Shree</a> is one of Piper&apos;s founders and Piper&apos;s Co-CEO, and she&apos;s maintained a vision for Piper Make and Piper as a whole that our products will engage kiddos through the power of stories.  The Piper Computer Kit does a lot of that using Minecraft Raspberry Pi Edition.</p>
                    <h4>Piper Make&apos;s Missing Piece</h4>
                    <p>Piper Make is incredibly cool, but it was missing something.  <em>Immersing kids in the story.</em></p>
                    <p>In December 2022, Shree asked if I could add something to the Getting Started tutorial of Piper Make: an immersive story element.</p>
                    <h4>Building a World</h4>
                    <p>Piper Make has always had a story: Piperbot (the lead character), is a robot that is sent by humans to explore Mars.  When Piperbot gets there, he meets Pip, a small mouse-like martian creature who helps Piperbot out on their adventures together on Mars.  It&apos;s a fun story and a neat way to tie everything together, but Piper Make wasn&apos;t <em>immersing</em> kids in that story.</p>
                    <p>The first lesson on both Piper Make and the original Piper Computer Kit asks the user to touch two wires together, and when they do, something happens. On the Piper Computer Kit, the user sees a world and is able to move their character through it by touching the wires together. In comparison,  Piper Make explained electricity and showed a GIF of current running through a wire. Admittedly, not nearly as exciting.</p>
                    <p>At the beginning of Piper Make&apos;s development, Piper commissioned a series of video clips to be used as intros and outros for each of the tutorials in Piper Make. They showed kiddos the Piper Make world, but we wanted to bring kids into the world of those video clips, as Piperbot and Pip explored Mars together. So, just like on the Piper Computer Kit, we set out to create that world.</p>
                    <h4>Capturing Virtual World Magic</h4>
                    <p>From the beginning, Piper has long drawn inspiration from the most engaging game out there for kids - Minecraft. However, Piper Computer Kits and Piper Make are not official Minecraft products, and are not approved by or associated with Mojang or Microsoft. The Raspberry Pi Edition of Minecraft by the Raspberry Pi Foundation is licensed under the Creative Commons Attribution 4.0 International License, which allowed the Piper Computer Kit to use the powerful interface to engage kiddos. But Piper Make, restricted to the browser, didn&apos;t have this luxury - so we had to figure out another way to bring the magic of virtual worlds to life.</p>
                    <p>I was already familiar with <a href="https://threejs.org/" target="_blank">Three.js</a> from using it to develop simulations to teach science concepts.  I knew we could use it to generate the kind of immersive experience that we needed for Piper Make.  I also knew that we had worked with an animator/modeler who just might still have the 3D assets he used to create the original intro and outro videos, so we reached out to him.</p>
                    <h4>He did not have the files :(</h4>
                    <p>Go figure.  Video content can take up a TON of memory and disk space, so I do not blame him at all for deleting most of what he had done.</p>
                    <p>He was able to send us a few assets - not a lot, but enough for me to download <a href="https://www.blender.org/" target="_blank">Blender</a> and go spelunking.</p>
                    <p>First off - mad props to all you 3D animators out there.  I respected what you did before, now I <em>really</em> respect what you do!  Next off, I figured a few things out.  I learned that you can export the things you create in Blender in GLTF format, and those files can be imported by Three.js (mostly). Additionally, I (more accurately, my daughter - yes she got paid for this) was able to use Minecraft: Education Edition to build the buildings and environments, too.  Those models could then be exported and directly read by Three.js as well.</p>
                    <img src="images/portfolio/piper-make/3d-world.png"/>
                    <p>We&apos;ve published the new version of <b>Getting Started</b> where touching two wires together helps Piperbot move forward:</p>
                    <img src="images/portfolio/piper-make/piper-make-getting-started.png"/>
                    <p>Next up is helping Pip light an LED so that Piperbot can land on Mars:</p>
                    <img src="images/portfolio/piper-make/pip-on-mars.png"/>
                    <p>I&apos;m really excited to begin this next chapter in Piper Make&apos;s story!</p>

                </div>
            </div>
        </div>
    </section>
    <script>hljs.highlightAll();</script>
</body>

</html>